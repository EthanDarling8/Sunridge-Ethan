@page
@model Sunridge.Pages.Owner.Classifieds.ClassifiedsUpsertModel
@{
    ViewData["Title"] = "ClassifiedsUpsert";
}
<form method="post" asp-action="ClassifiedsUpsert" enctype="multipart/form-data">
    <div class="container">
        <div class="row px-2 mx-2 backgroundWhite border">
            <div asp-validation-summary="ModelOnly" class="text-danger">

            </div>

            @*<div class="col-12 px-3" style="border-bottom:1px solid #325d88">
                    <h2 class="text-primary">@(Model.ClassifiedsItemObj.ClassifiedsItem.Id != 0 ? "Update" : "Create") Menu Item</h2>
                </div>*@

        <div class="col-8 pt-3">
            <div class="form-group row">
                <div class="col-3">
                    <label asp-for="ClassifiedsItemObj.ClassifiedsItem.Title"></label>
                </div>
                <div class="col-9">
                    <input class="form-control" asp-for="ClassifiedsItemObj.ClassifiedsItem.Title" />
                    <span class="text-danger" asp-validation-for="ClassifiedsItemObj.ClassifiedsItem.Title"></span>
                </div>
                @if (Model.ClassifiedsItemObj.ClassifiedsItem.Id != 0)
                {
                    <input type="hidden" asp-for="ClassifiedsItemObj.ClassifiedsItem.Id" />
                }
            </div>
            <div class="form-group row">
                <div class="col-3">
                    <label asp-for="ClassifiedsItemObj.ClassifiedsItem.CategoryId"></label>
                </div>
                <div class="col-9">
                    @Html.DropDownListFor(c => c.ClassifiedsItemObj.ClassifiedsItem.CategoryId,
                                          Model.ClassifiedsItemObj.ClassifiedsCategoryList,
                                          "- Please select a category - ",
                                          new { @class = "form-control" })

                    <span class="text-danger" asp-validation-for="ClassifiedsItemObj.ClassifiedsItem.CategoryId"></span>
                </div>
            </div>
            <div class="form-group row">
                <div class="col-3">
                    <label asp-for="ClassifiedsItemObj.ClassifiedsItem.SubcategoryId"></label>
                </div>
                <div class="col-9">
                    @Html.DropDownListFor(c => c.ClassifiedsItemObj.ClassifiedsItem.SubcategoryId,
                                          Model.ClassifiedsItemObj.ClassifiedsSubcategoryList,
                                          "- Please select a Subcategory - ",
                                          new { @class = "form-control" })

                    <span class="text-danger" asp-validation-for="ClassifiedsItemObj.ClassifiedsItem.SubcategoryId"></span>
                </div>
            </div>
            <div class="form-group row">
                <div class="col-3">
                    <label asp-for="ClassifiedsItemObj.ClassifiedsItem.Description"></label>
                </div>
                <div class="col-9">
                    <textarea class="form-control" asp-for="ClassifiedsItemObj.ClassifiedsItem.Description" id="txtDesc" style="height: 200px;"></textarea>
                </div>
            </div>
            <div class="form-group row">
                <div class="col-3">
                    <label asp-for="ClassifiedsItemObj.ClassifiedsItem.Price"></label>
                </div>
                <div class="col-9">
                    <input class="form-control" asp-for="ClassifiedsItemObj.ClassifiedsItem.Price" />
                    <span class="text-danger" asp-validation-for="ClassifiedsItemObj.ClassifiedsItem.Price"></span>
                </div>
            </div>

            <div class="form-group row">
                <div class="col-3">
                    <label asp-for="ClassifiedsItemObj.ClassifiedsItem.Images"></label>
                </div>
                <div class="col-9">
                    <input type="file" class="form-control" id="uploadBox" name="files" accept="image/x-png,image/gif,image/jpeg" multiple="multiple" />

                </div>
            </div>
            <div class="form-group row">
                <div class="col-3">
                    <label asp-for="ClassifiedsItemObj.ClassifiedsItem.Name"></label>
                </div>
                <div class="col-9">
                    <input class="form-control" asp-for="ClassifiedsItemObj.ClassifiedsItem.Name" />
                    <span class="text-danger" asp-validation-for="ClassifiedsItemObj.ClassifiedsItem.Name"></span>
                </div>
            </div>
            <div class="form-group row">
                <div class="col-3">
                    <label asp-for="ClassifiedsItemObj.ClassifiedsItem.Phone"></label>
                </div>
                <div class="col-9">
                    <input class="form-control" asp-for="ClassifiedsItemObj.ClassifiedsItem.Phone" id="bar" placeholder="(123) 456-7890" 
                           type="text" name="txtInput" onkeydown="javascript:backspacerDOWN(this,event);" onkeyup="javascript:backspacerUP(this,event);" />
                    <span class="text-danger" asp-validation-for="ClassifiedsItemObj.ClassifiedsItem.Phone"></span>
                </div>
            </div>

            <div class="form-group row">
                <div class="col-3">
                    <label asp-for="ClassifiedsItemObj.ClassifiedsItem.Email"></label>
                </div>
                <div class="col-9">
                    <input class="form-control" asp-for="ClassifiedsItemObj.ClassifiedsItem.Email" />
                    <span class="text-danger" asp-validation-for="ClassifiedsItemObj.ClassifiedsItem.Email"></span>
                </div>
            </div>

            <div class="form-group row">
                <div class="col-3">
                    <label asp-for="ClassifiedsItemObj.ClassifiedsItem.Website"></label>
                </div>
                <div class="col-9">
                    <input class="form-control" asp-for="ClassifiedsItemObj.ClassifiedsItem.Website" />
                    <span class="text-danger" asp-validation-for="ClassifiedsItemObj.ClassifiedsItem.Website"></span>
                </div>
            </div>
            <div class="form-group row" hidden>
                <div class="col-3">
                    <label asp-for="ClassifiedsItemObj.ClassifiedsItem.TimeAdded"></label>
                </div>
                <div class="col-9">
                    <input class="form-control" asp-for="ClassifiedsItemObj.ClassifiedsItem.TimeAdded" id="time" />
                    <span class="text-danger" asp-validation-for="ClassifiedsItemObj.ClassifiedsItem.TimeAdded"></span>
                </div>
            </div>

            <div class="form-group row">
                <div class="col-9 offset-3">
                    <div class="row">
                        <div class="col-6">
                            @if (Model.ClassifiedsItemObj.ClassifiedsItem.Id != 0)
                            {
                                <button type="submit" class="btn btn-primary form-control">Update Listing</button>
                            }
                            else
                            {
                                <button type="submit" class="btn btn-primary form-control" onclick="return ValidateInput();">Create Listing</button>
                            }

                        </div>
                        <div class="col-6">
                            <a href="./ClassifiedsIndex" class="btn btn-success form-control">Back</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
            @*@if (Model.MenuItemObj.MenuItem != null)
                {
                    <div class="col-4 p-4">
                        <img src="@Model.MenuItemObj.MenuItem.Image" style="border-radius: 5px; width:100%; border: 1px solid #bbb9b9" />
                    </div>
                }*@
        </div>
    </div>
</form>

@section Scripts{

    section Scripts{
    <partial name="_ValidationScriptsPartial" />
    }

    <script>

        tinymce.init({
            selector: 'textarea',
            plugins: "lists",
            menubar: 'file edit format'
        });



        function ValidateInput() {
            if (document.getElementById("uploadBox").value == "") {
                swal('Error', 'Please Select an Image', 'error')
                return false;
            }
            return true;
        }
        var x = timeSince();
        document.getElementById("time").innerHTML = x;

        function timeSince(date) {

            var seconds = Math.floor((new Date().getTime() / 1000) - date);

            var interval = seconds / 31536000;

            if (interval >= 1) {
                return Math.floor(interval) + " years";
            }
            interval = seconds / 2592000;
            if (interval >= 1) {
                return Math.floor(interval) + " months";
            }
            interval = seconds / 86400;
            if (interval >= 1) {
                return Math.floor(interval) + " days";
            }
            interval = seconds / 3600;
            if (interval >= 1) {
                return Math.floor(interval) + " hours";
            }
            interval = seconds / 60;
            if (interval >= 1) {
                return Math.floor(interval) + " minutes";
            }
            return Math.floor(seconds) + " seconds";
        }
        var aDay = 24 * 60 * 60 * 1000;
        console.log(timeSince(new Date(Date.now() - aDay)));
        console.log(timeSince(new Date(Date.now() - aDay * 2)));

        var zChar = new Array(' ', '(', ')', '-', '.');
        var maxphonelength = 13;
        var phonevalue1;
        var phonevalue2;
        var cursorposition;

        function ParseForNumber1(object) {
            phonevalue1 = ParseChar(object.value, zChar);
        }

        function ParseForNumber2(object) {
            phonevalue2 = ParseChar(object.value, zChar);
        }

        function backspacerUP(object, e) {
            if (e) {
                e = e
            } else {
                e = window.event
            }
            if (e.which) {
                var keycode = e.which
            } else {
                var keycode = e.keyCode
            }

            ParseForNumber1(object)

            if (keycode >= 48) {
                ValidatePhone(object)
            }
        }

        function backspacerDOWN(object, e) {
            if (e) {
                e = e
            } else {
                e = window.event
            }
            if (e.which) {
                var keycode = e.which
            } else {
                var keycode = e.keyCode
            }
            ParseForNumber2(object)
        }

        function GetCursorPosition() {

            var t1 = phonevalue1;
            var t2 = phonevalue2;
            var bool = false
            for (i = 0; i < t1.length; i++) {
                if (t1.substring(i, 1) != t2.substring(i, 1)) {
                    if (!bool) {
                        cursorposition = i
                        bool = true
                    }
                }
            }
        }

        function ValidatePhone(object) {

            var p = phonevalue1

            p = p.replace(/[^\d]*/gi, "")

            if (p.length < 3) {
                object.value = p
            } else if (p.length == 3) {
                pp = p;
                d4 = p.indexOf('(')
                d5 = p.indexOf(')')
                if (d4 == -1) {
                    pp = "(" + pp;
                }
                if (d5 == -1) {
                    pp = pp + ")";
                }
                object.value = pp;
            } else if (p.length > 3 && p.length < 7) {
                p = "(" + p;
                l30 = p.length;
                p30 = p.substring(0, 4);
                p30 = p30 + ")"

                p31 = p.substring(4, l30);
                pp = p30 + p31;

                object.value = pp;

            } else if (p.length >= 7) {
                p = "(" + p;
                l30 = p.length;
                p30 = p.substring(0, 4);
                p30 = p30 + ")"

                p31 = p.substring(4, l30);
                pp = p30 + p31;

                l40 = pp.length;
                p40 = pp.substring(0, 8);
                p40 = p40 + "-"

                p41 = pp.substring(8, l40);
                ppp = p40 + p41;

                object.value = ppp.substring(0, maxphonelength);
            }

            GetCursorPosition()

            if (cursorposition >= 0) {
                if (cursorposition == 0) {
                    cursorposition = 2
                } else if (cursorposition <= 2) {
                    cursorposition = cursorposition + 1
                } else if (cursorposition <= 5) {
                    cursorposition = cursorposition + 2
                } else if (cursorposition == 6) {
                    cursorposition = cursorposition + 2
                } else if (cursorposition == 7) {
                    cursorposition = cursorposition + 4
                    e1 = object.value.indexOf(')')
                    e2 = object.value.indexOf('-')
                    if (e1 > -1 && e2 > -1) {
                        if (e2 - e1 == 4) {
                            cursorposition = cursorposition - 1
                        }
                    }
                } else if (cursorposition < 11) {
                    cursorposition = cursorposition + 3
                } else if (cursorposition == 11) {
                    cursorposition = cursorposition + 1
                } else if (cursorposition >= 12) {
                    cursorposition = cursorposition
                }

                var txtRange = object.createTextRange();
                txtRange.moveStart("character", cursorposition);
                txtRange.moveEnd("character", cursorposition - object.value.length);
                txtRange.select();
            }

        }

        function ParseChar(sStr, sChar) {
            if (sChar.length == null) {
                zChar = new Array(sChar);
            } else zChar = sChar;

            for (i = 0; i < zChar.length; i++) {
                sNewStr = "";

                var iStart = 0;
                var iEnd = sStr.indexOf(sChar[i]);

                while (iEnd != -1) {
                    sNewStr += sStr.substring(iStart, iEnd);
                    iStart = iEnd + 1;
                    iEnd = sStr.indexOf(sChar[i], iStart);
                }
                sNewStr += sStr.substring(sStr.lastIndexOf(sChar[i]) + 1, sStr.length);

                sStr = sNewStr;
            }

            return sNewStr;
        }
        var clipboard = new Clipboard('.btn');

        clipboard.on('success', function (e) {
            console.log(e);
        });

        clipboard.on('error', function (e) {
            console.log(e);
        });
        
    </script>

}


